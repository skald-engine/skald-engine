<!DOCTYPE html>
<html>
<head>
  <title></title>
  <script type="text/javascript" src="/build/lib/skald.min.js"></script>
</head>
<body>
  
  <h1>
    Particle Emitter
    <small>(FPS: <span id="fps">60</span>)</small>
    <small>(Particles: <span id="counter">0</span>)</small>
  </h1>


  <script>
    // Configuration ----------------------------------------------------------
    sk.scene({
      name: 'base',
      initialize: function() {
        let container = new PIXI.ParticleContainer(15000, {
          scale    : true,
          position : true,
          rotation : false,
          alpha    : true
        })
        container.blendMode = sk.BLEND_MODE.ADD
        
        // let container = new PIXI.Container()

        this.emitter = new sk.particles.Emitter(container, [], {
          textures: [
            game.resources.get('red'),
          ],
          emissor: new sk.particles.emissors.SquareEmissor(100, 0),

          alphaEase: sk.utils.easing.quadInOut,
          scaleEase: sk.utils.easing.expoIn,
          // emissionAngleFromCenter: true,
          emissionAngle: -Math.PI/2,
          emissionAngleVar: Math.PI/10,
          burstInterval: 500,
          // duration: 1000,
          life: 3000,
          maxParticles: 1000,
          emissionRate: 10,
          startSpeed: 500,
          endSpeed: 10,
          startScale: 0.5,
          endScale: 0,
        })
        this.addStatic(container)

        this.emitter.start()
      },

      update: function(delta) {
        // this.s.texture = game.resources.get('particle')
        this.emitter.emissionX = game.mouse.x
        this.emitter.emissionY = game.mouse.y
        this.emitter.update(delta)

        if (game.mouse.isPressed(sk.BUTTON.LEFT)) {
          this.emitter.burst()
        }

        document.getElementById('fps').innerHTML = game.time.fps
        document.getElementById('counter').innerHTML = this.emitter.counter
      }
    })

    // Game initialization ----------------------------------------------------
    const config = {
      resources: {basePath: '../../assets/spritesheets/'},
      display: {width: 1024, height: 768, backgroundColor:'#000000'},
      logger: {level: 'trace'}
    }
    const manifest = [
      {id:'particles', type:'spriteSheet', url: 'particles.json'},
    ]
    let game = new sk.Game(config, manifest)

    // Starting ---------------------------------------------------------------
    game.addEventListener('resources.complete', () => {
      game.scenes.play('base')
    })

  </script>

</body>
</html>