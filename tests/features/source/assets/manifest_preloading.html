<!DOCTYPE html>
<html>
<head>
  <title></title>
  <script type="text/javascript" src="/build/lib/skald.min.js"></script>
</head>
<body>
  
  <h1>Manifest Preloading</h1>

  <h3>Loading log:</h3>
  <p>It must finish with "Completed!" string and cannot have any red item.</p>
  <ul id="log"></ul>
  <div id="assets"></div>

  <script>
    // Logging configuration --------------------------------------------------
    let div = document.getElementById('log')
    function log(value) {
      div.innerHTML = div.innerHTML + `<li>${value}</li>`
    }

    // Game initialization ----------------------------------------------------
    let game = new sk.Game({
      resources: {
        basePath:  '../../assets/'
      },
      display: {
        width: 1,
        height: 1
      }
    })

    // Callbacks --------------------------------------------------------------
    game.addEventListener('resourceprogress', function(event) {
      log(`<span style="color:#A2A2A2;"> `+
            `Progress `+
            `${parseInt(event.progress*100)}% `+
            `(${event.loaded} of `+
            `${event.total})`+
          `</span>`)
    })
    game.addEventListener('resourceload', function(event) {
      log(`Load "${event.url}" to id "${event.id}"`)
    })
    game.addEventListener('resourceerror', function(event) {
      log(`<span style="color:#BA1616;">ERROR "${event.message}"</span>`)
    })
    game.addEventListener('resourcecomplete', function(event) {
      log(`Completed!`)
      let div = document.getElementById('assets')
      div.innerHTML = '<h3>Assets loaded:</h3>'
      div.innerHTML += game.resources.list().join('<br>')
    })

    // Starting ---------------------------------------------------------------
    game.resources.addManifest([
      {
        id   : 'asset_texture',
        type : 'texture',
        url  : 'textures/zombie.png'
      },
      {
        id   : 'asset_json',
        type : 'json',
        url  : 'spritesheets/samurai_idle.json'
      },
      {
        id   : 'asset_raw',
        type : 'raw',
        url  : 'LICENSES.md'
      },
      {
        id   : 'asset_audio',
        type : 'audio',
        url  : ['sfxs/coin_2.ogg', 'sfxs/coin_2.mp3'],
        data : {offset: 0.1, duration: 1, volume: 0.1, loop: true}
      },
      {
        type : 'audioSprite',
        url  : ['sfxs/sprite.ogg', 'sfxs/sprite.mp3'],
        data : [
          {id:'asset_audiosprite_p1', offset:0, duration:640},
          {id:'asset_audiosprite_p2', offset:1, duration:800},
          {id:'asset_audiosprite_p3', offset:2, duration:640},
          {id:'asset_audiosprite_p4', offset:3, duration:2273}
        ]
      },
      {
        id   : 'asset_bitmapfont',
        type : 'bitmapFont',
        url  : 'bitmapfonts/wing.xml'
      },
      {
        id   : 'asset_irregular_spritesheet',
        type : 'spriteSheet',
        url  : 'spritesheets/samurai_idle.json'
      },
      {
        id   : 'asset_regular_spritesheet',
        type : 'spriteSheet',
        url  : 'spritesheets/zombie_walking.png',
        data : {
          frames: {
            width   : 400,
            height  : 300,
            count   : 18,
            spacing : 0,
            margin  : 0,
          }
        }
      },

    ])
    game.resources.load()
  </script>

</body>
</html>