<!DOCTYPE html>
<html>
<head>
  <title></title>
  <script type="text/javascript" src="/build/lib/skald.min.js"></script>
</head>
<body>
  
  <h1>ECS</h1>

  <script>
    // Configuration ----------------------------------------------------------
    const ButtonComponent = sk.component({
      data: {
        hover: false,
        down: false,
      },
      methods: {
        sample: function() {
          console.log('sample')
        }
      }
    })

    const ButtonEntity = sk.entity({
      initialize: function() {
        this.display = new sk.display.Sprite()
        this.display.texture = game.resources.get('bug')

        this.addTag('button', 'updatable')

        this.button = this.addComponent(new ButtonComponent())
      }
    })

    const UpdateSystem = sk.system({
      check: function(entity) {
        return entity.hasTag('updatable')
      },
      update: function(entities, delta) {
        // console.log('Updating system with '+entities.length+' entities.')
      }
    })

    const EventSheet = sk.eventSheet({
      events: {
        'scenes.start': function(e) {
          console.log('start function')
        },
        'update': function(e) {
          // console.log('update function')
        }
      }
    })

    const BaseScene = sk.scene({
      initialize: function() {
        this.addLayer('background')
        this.addLayer('objects')
        this.addLayer('foreground')
        this.addLayer('ui')

        this.addSystem(new UpdateSystem())
        this.addEventSheet(new EventSheet())

        let entity = this.addEntity(new ButtonEntity())

        let s = new sk.display.Sprite()
        s.texture = game.resources.get('bug')
        s.position = {x:200, y:200}
        this.addStatic(s)

        s = new sk.display.Sprite()
        s.texture = game.resources.get('bug')
        s.anchor = {x:.5, y:.5}
        s.position = {x:100, y:100}
        s.rotation = Math.PI
        this.addStatic(s, 'ui')
        this.removeStatic(s)

        this.addTask(new sk.utils.tasks.Tween(
          entity.display,
          {x:[0, 100]},
          1000,
          0,
          true,
          sk.utils.easing.gaussian
        ))
        this.addTask(new sk.utils.tasks.Tween(
          entity.display,
          {y:[0, 200]},
          1500,
          0,
          true,
          sk.utils.easing.gaussian
        ))
      },
      methods: {
        emit: function(e) {
          // console.log('emitting:', e)
          sk.core.Scene.prototype.emit.call(this, e)
        }
      }
    })

    // Game initialization ----------------------------------------------------
    const config = {
      display: {width: 300, height: 400},
      logger: {level: 'trace'}
    }
    let game = new sk.Game(config)
    let scene

    // Starting ---------------------------------------------------------------
    game.resources.addTexture('bug', '../features/assets/textures/ladybug.png')
    game.resources.load()
    game.addEventListener('start', () => {
      scene = new BaseScene(game)
      game.scenes.play(scene)

    })

  </script>

</body>
</html>